        
parameters:
- name: application_name
  type: string
  default: "none"

- name: application_version
  type: string
  default: "1.0.0-SNAPSHOT"

steps:
- task: Bash@3
  displayName: "Packaging Application ${{parameters.application_name}}"
  inputs:
    failOnStderr: true
    targetType: 'inline'
    script: |
      # Write your commands here
      #set -x
      if [ "${{parameters.application_name}}" == "none" ];then
        echo "please provide an application name to the azure-package template via parameter APPLICATION_NAME"
        exit 1
      fi

      echo ${{parameters.application_name}}
      
      #IN case we want to set an azure variable:
      #echo '##vso[task.setvariable variable=a]20'
      
      #application_name=${{parameters.application_name}} #now from pipeline variable
      application_version=1.0.0-SNAPSHOT
      build_dir="$(System.DefaultWorkingDirectory)/build/${{parameters.application_name}}"
      config_dir="${build_dir}/config"
      config_file="${config_dir}/application.cfg"
      publish_dir="$(System.DefaultWorkingDirectory)/publish/${{parameters.application_name}}"

      if [ -d $build_dir ];then
        rm -rf $build_dir/*
      else
        mkdir -p $build_dir
      fi

      if [ ! -d $config_dir ];then
        mkdir -p $config_dir
      fi

      if [ ! -d $publish_dir ];then
        mkdir -p $publish_dir
      fi

      cp $(System.DefaultWorkingDirectory)/${{parameters.application_name}}/target/${{parameters.application_name}}-*-bootable.jar $build_dir/
        
      cd ${build_dir}/../ ; tar -cvf ${publish_dir}/${{parameters.application_name}}-${{parameters.application_version}}.tar ${{parameters.application_name}}
      ls -la ${publish_dir}/**

- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '$(System.DefaultWorkingDirectory)/publish/${{parameters.application_name}}'
    artifact: '${{parameters.application_name}}'
    publishLocation: 'pipeline'