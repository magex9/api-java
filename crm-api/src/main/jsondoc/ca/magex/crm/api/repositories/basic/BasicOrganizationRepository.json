{
  "name": "BasicOrganizationRepository",
  "package": "ca.magex.crm.api.repositories.basic",
  "imports": {
    "Collectors": "java.util.stream",
    "Stream": "java.util.stream",
    "SerializationUtils": "org.apache.commons.lang3",
    "OrganizationDetails": "ca.magex.crm.api.crm",
    "OrganizationSummary": "ca.magex.crm.api.crm",
    "OrganizationsFilter": "ca.magex.crm.api.filters",
    "PageBuilder": "ca.magex.crm.api.filters",
    "Paging": "ca.magex.crm.api.filters",
    "CrmUpdateNotifier": "ca.magex.crm.api.observer",
    "CrmOrganizationRepository": "ca.magex.crm.api.repositories",
    "CrmStore": "ca.magex.crm.api.repositories",
    "FilteredPage": "ca.magex.crm.api.system",
    "Identifier": "ca.magex.crm.api.system"
  },
  "type": "class",
  "modifiers": ["public"],
  "implements": ["CrmOrganizationRepository"],
  "constructors": [{
    "name": "BasicOrganizationRepository",
    "modifiers": ["public"],
    "parameters": [
      {
        "name": "store",
        "type": "CrmStore"
      },
      {
        "name": "notifier",
        "type": "CrmUpdateNotifier"
      }
    ],
    "body": "{\n    this.store = store;\n    this.notifier = notifier;\n}"
  }],
  "fields": [
    {
      "name": "store",
      "modifiers": ["private"],
      "type": "CrmStore"
    },
    {
      "name": "notifier",
      "modifiers": ["private"],
      "type": "CrmUpdateNotifier"
    }
  ],
  "methods": [
    {
      "name": "apply",
      "modifiers": ["private"],
      "type": {
        "class": "Stream",
        "generics": ["OrganizationDetails"]
      },
      "parameters": [{
        "name": "filter",
        "type": "OrganizationsFilter"
      }],
      "body": "{\n    return store.getOrganizations().values().stream().filter(p -> filter.apply(p));\n}"
    },
    {
      "name": "findOrganizationDetails",
      "modifiers": ["public"],
      "type": {
        "class": "FilteredPage",
        "generics": ["OrganizationDetails"]
      },
      "annotations": [{"name": "Override"}],
      "parameters": [
        {
          "name": "filter",
          "type": "OrganizationsFilter"
        },
        {
          "name": "paging",
          "type": "Paging"
        }
      ],
      "body": "{\n    return PageBuilder.buildPageFor(filter, apply(filter).map(i -> SerializationUtils.clone(i)).sorted(filter.getComparator(paging)).collect(Collectors.toList()), paging);\n}"
    },
    {
      "name": "findOrganizationSummary",
      "modifiers": ["public"],
      "type": {
        "class": "FilteredPage",
        "generics": ["OrganizationSummary"]
      },
      "annotations": [{"name": "Override"}],
      "parameters": [
        {
          "name": "filter",
          "type": "OrganizationsFilter"
        },
        {
          "name": "paging",
          "type": "Paging"
        }
      ],
      "body": "{\n    return PageBuilder.buildPageFor(filter, apply(filter).map(i -> SerializationUtils.clone(i)).sorted(filter.getComparator(paging)).collect(Collectors.toList()), paging);\n}"
    },
    {
      "name": "countOrganizations",
      "modifiers": ["public"],
      "type": "long",
      "annotations": [{"name": "Override"}],
      "parameters": [{
        "name": "filter",
        "type": "OrganizationsFilter"
      }],
      "body": "{\n    return apply(filter).count();\n}"
    },
    {
      "name": "findOrganizationDetails",
      "modifiers": ["public"],
      "type": "OrganizationDetails",
      "annotations": [{"name": "Override"}],
      "parameters": [{
        "name": "organizationId",
        "type": "Identifier"
      }],
      "body": "{\n    return store.getOrganizations().get(organizationId);\n}"
    },
    {
      "name": "findOrganizationSummary",
      "modifiers": ["public"],
      "type": "OrganizationSummary",
      "annotations": [{"name": "Override"}],
      "parameters": [{
        "name": "organizationId",
        "type": "Identifier"
      }],
      "body": "{\n    return findOrganizationDetails(organizationId);\n}"
    },
    {
      "name": "saveOrganizationDetails",
      "modifiers": ["public"],
      "type": "OrganizationDetails",
      "annotations": [{"name": "Override"}],
      "parameters": [{
        "name": "organization",
        "type": "OrganizationDetails"
      }],
      "body": "{\n    notifier.organizationUpdated(System.nanoTime(), organization.getOrganizationId());\n    store.getOrganizations().put(organization.getOrganizationId(), organization);\n    return organization;\n}"
    }
  ]
}